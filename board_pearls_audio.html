<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes">
    <title>üéß Board Pearls ‚Äî Audio Edition</title>
    <style>
        :root { --primary: #f59e0b; --primary-light: #fbbf24; --accent: #e07b53; --bg: #1a1a2e; --card-bg: #16213e; --text: #e8e8e8; --text-muted: #a0a0a0; --border: #2d3a4f; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); line-height: 1.8; padding: 20px; padding-bottom: 200px; font-size: 18px; }
        .header { text-align: center; padding: 30px 20px; background: linear-gradient(135deg, var(--primary), var(--primary-light)); border-radius: 16px; margin-bottom: 20px; color: #1a1a2e; }
        .header h1 { font-size: 1.5rem; margin-bottom: 8px; }
        .audio-controls { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(22,33,62,0.98); padding: 15px 20px; padding-bottom: max(15px, env(safe-area-inset-bottom)); border-top: 1px solid var(--border); z-index: 1000; }
        .controls-row { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px; }
        .control-btn { background: var(--primary); border: none; color: #1a1a2e; width: 50px; height: 50px; border-radius: 50%; font-size: 1.3rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .control-btn.play-btn { width: 65px; height: 65px; font-size: 1.6rem; background: var(--accent); color: white; }
        .progress-section { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; color: var(--text-muted); }
        .progress-bar { flex: 1; height: 6px; background: var(--border); border-radius: 3px; cursor: pointer; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; }
        .current-topic { text-align: center; font-size: 0.85rem; color: var(--accent); margin-top: 8px; }
        .settings-row { display: flex; justify-content: center; gap: 20px; margin-top: 10px; }
        .speed-control select, .pause-control select { background: var(--card-bg); color: var(--text); border: 1px solid var(--border); padding: 6px 10px; border-radius: 8px; }
        .section { background: var(--card-bg); border-radius: 12px; margin-bottom: 20px; }
        .section-header { background: var(--primary); padding: 15px 20px; font-size: 1.1rem; font-weight: 600; display: flex; justify-content: space-between; color: #1a1a2e; border-radius: 12px 12px 0 0; }
        .section-content { padding: 20px; }
        .topic { margin-bottom: 20px; }
        .topic-title { font-size: 1rem; font-weight: 600; color: var(--primary); margin-bottom: 12px; }
        .pearl { margin-bottom: 12px; padding: 12px 15px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border-left: 3px solid var(--primary); }
        .current { background: rgba(245, 158, 11, 0.3) !important; }
        .voice-selector { margin: 15px 0; padding: 15px; background: var(--card-bg); border-radius: 12px; }
        .voice-selector select { width: 100%; padding: 10px; background: var(--bg); color: var(--text); border: 1px solid var(--border); border-radius: 8px; }
        .toc { background: var(--card-bg); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .toc-item { padding: 10px 15px; margin: 5px 0; background: rgba(255,255,255,0.03); border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; }
        .toc-item.active { background: var(--primary); color: #1a1a2e; }
    </style>
</head>
<body>
<div class="header"><h1>üíé Board Pearls</h1><p>Audio Edition ‚Ä¢ High-Yield ABIM Review</p><p style="font-size:0.8rem; opacity:0.8; margin-top:8px;">v1.0 BUILD #8</p></div>
<div class="voice-selector"><label>üéôÔ∏è Voice:</label><select id="voiceSelect"></select></div>
<div class="toc"><h2>üìã Specialties</h2>
    <div class="toc-item" data-section="0"><span>1. Infectious Disease</span><span>~5 min</span></div>
    <div class="toc-item" data-section="1"><span>2. Cardiology</span><span>~5 min</span></div>
    <div class="toc-item" data-section="2"><span>3. Gastroenterology</span><span>~4 min</span></div>
    <div class="toc-item" data-section="3"><span>4. Rheumatology</span><span>~4 min</span></div>
    <div class="toc-item" data-section="4"><span>5. Endocrinology</span><span>~4 min</span></div>
    <div class="toc-item" data-section="5"><span>6. Nephrology</span><span>~4 min</span></div>
    <div class="toc-item" data-section="6"><span>7. Pulmonology</span><span>~4 min</span></div>
    <div class="toc-item" data-section="7"><span>8. Hematology</span><span>~4 min</span></div>
    <div class="toc-item" data-section="8"><span>9. Neurology</span><span>~3 min</span></div>
    <div class="toc-item" data-section="9"><span>10. Other Specialties</span><span>~4 min</span></div>
</div>
<div id="audioContent">

<div class="section" data-section="0">
    <div class="section-header"><span>1. Infectious Disease</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">Bacterial Infections</div>
            <p class="speakable">Staph aureus bacteremia requires at least 4 to 6 weeks of IV antibiotics. Always get echo to rule out endocarditis.</p>
            <p class="speakable">Bacterial meningitis empiric therapy is vancomycin plus ceftriaxone plus ampicillin if over 50 or immunocompromised.</p>
            <p class="speakable">Give dexamethasone before or with first antibiotic dose for suspected bacterial meningitis.</p>
            <p class="speakable">Blood cultures before antibiotics, but never delay antibiotics for cultures in sepsis.</p>
        </div>
        <div class="topic"><div class="topic-title">Specific Organisms</div>
            <p class="speakable">C. diff first episode treatment is oral vancomycin, not metronidazole. Use fidaxomicin for recurrence.</p>
            <p class="speakable">Pseudomonas requires double coverage initially. Think of it in CF, neutropenia, and ICU patients.</p>
            <p class="speakable">MRSA coverage with vancomycin or daptomycin. Daptomycin is inactivated by pulmonary surfactant so never use for pneumonia.</p>
            <p class="speakable">PJP prophylaxis with TMP-SMX for HIV with CD4 under 200 or high-dose steroids.</p>
        </div>
        <div class="topic"><div class="topic-title">HIV Pearls</div>
            <p class="speakable">Start antiretrovirals in all HIV patients regardless of CD4 count.</p>
            <p class="speakable">Immune reconstitution inflammatory syndrome, or IRIS, occurs when starting ART with opportunistic infection present.</p>
            <p class="speakable">In cryptococcal meningitis, delay ART for 4 to 6 weeks to reduce IRIS risk.</p>
        </div>
    </div>
</div>

<div class="section" data-section="1">
    <div class="section-header"><span>2. Cardiology</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">ACS Management</div>
            <p class="speakable">STEMI requires door to balloon time under 90 minutes. If PCI not available in 120 minutes, give fibrinolytics.</p>
            <p class="speakable">Prasugrel is contraindicated in prior stroke or TIA.</p>
            <p class="speakable">Beta-blockers are contraindicated if signs of acute heart failure, hypotension, bradycardia, or cocaine use.</p>
            <p class="speakable">Right ventricular infarct presents with hypotension, clear lungs, and elevated JVP. Treat with fluids, avoid nitroglycerin and diuretics.</p>
        </div>
        <div class="topic"><div class="topic-title">Heart Failure</div>
            <p class="speakable">The four pillars of HFrEF are ARNI or ACE inhibitor, beta-blocker, MRA, and SGLT2 inhibitor.</p>
            <p class="speakable">SGLT2 inhibitors benefit heart failure regardless of diabetes status.</p>
            <p class="speakable">Don't stop beta-blocker in acute heart failure unless hypotensive or in cardiogenic shock.</p>
            <p class="speakable">Avoid non-dihydropyridine calcium channel blockers in HFrEF.</p>
        </div>
        <div class="topic"><div class="topic-title">Arrhythmias</div>
            <p class="speakable">Atrial fibrillation with rapid ventricular response plus pre-excitation is a medical emergency. Avoid AV nodal blockers. Use procainamide or cardioversion.</p>
            <p class="speakable">Wide complex tachycardia is VT until proven otherwise. If unsure, treat as VT.</p>
            <p class="speakable">Torsades de pointes treatment is IV magnesium 2 grams and overdrive pacing.</p>
            <p class="speakable">Dronedarone is contraindicated in heart failure.</p>
        </div>
        <div class="topic"><div class="topic-title">Valvular and Pericardial</div>
            <p class="speakable">Aortic stenosis symptoms are syncope, angina, and heart failure. Once symptomatic, valve replacement is indicated.</p>
            <p class="speakable">Cardiac tamponade shows Beck's triad and pulsus paradoxus. Treatment is emergent pericardiocentesis.</p>
            <p class="speakable">Constrictive pericarditis shows Kussmaul's sign and calcified pericardium.</p>
            <p class="speakable">Give high-intensity statin for all ASCVD patients regardless of baseline LDL.</p>
        </div>
    </div>
</div>

<div class="section" data-section="2">
    <div class="section-header"><span>3. Gastroenterology</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">Upper GI</div>
            <p class="speakable">Variceal bleed requires octreotide plus PPI plus ceftriaxone plus emergent EGD within 12 hours.</p>
            <p class="speakable">H. pylori treatment is PPI plus clarithromycin plus amoxicillin for 14 days. Always confirm eradication.</p>
            <p class="speakable">Barrett's esophagus is intestinal metaplasia requiring surveillance based on dysplasia grade.</p>
        </div>
        <div class="topic"><div class="topic-title">Liver Disease</div>
            <p class="speakable">Acute liver failure is INR greater than 1.5 plus encephalopathy. N-acetylcysteine helps for all causes.</p>
            <p class="speakable">Hepatorenal syndrome treatment is albumin plus midodrine plus octreotide. Or norepinephrine if in ICU.</p>
            <p class="speakable">SBP prophylaxis with fluoroquinolone or TMP-SMX if ascites protein under 1.5 plus risk factors.</p>
        </div>
        <div class="topic"><div class="topic-title">IBD and Pancreas</div>
            <p class="speakable">UC has continuous involvement always starting at rectum. Crohn's has skip lesions and is transmural.</p>
            <p class="speakable">Toxic megacolon requires NPO, IV steroids, broad-spectrum antibiotics. Surgery if no improvement.</p>
            <p class="speakable">Screen for TB and Hep B before starting biologics.</p>
            <p class="speakable">Gallstone pancreatitis needs ERCP within 24 hours if cholangitis present, and cholecystectomy before discharge.</p>
        </div>
        <div class="topic"><div class="topic-title">Biliary</div>
            <p class="speakable">Charcot's triad for cholangitis is fever, RUQ pain, and jaundice. Reynolds pentad adds shock and altered mental status.</p>
            <p class="speakable">PSC is associated with ulcerative colitis. Shows beading on MRCP and increases cholangiocarcinoma risk.</p>
            <p class="speakable">PBC is AMA positive with elevated alk phos and pruritus. Treatment is ursodiol.</p>
        </div>
    </div>
</div>

<div class="section" data-section="3">
    <div class="section-header"><span>4. Rheumatology</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">Diagnostic Pearls</div>
            <p class="speakable">Negative ANA essentially rules out SLE. Sensitivity is over 95 percent.</p>
            <p class="speakable">CRP is usually normal in SLE flares. If elevated, think infection.</p>
            <p class="speakable">Uric acid can be normal during acute gout attack. Don't use to rule out gout.</p>
            <p class="speakable">DIP joint involvement suggests OA or psoriatic arthritis, NOT rheumatoid arthritis.</p>
            <p class="speakable">Morning stiffness over 1 hour suggests inflammatory arthritis. Under 30 minutes suggests mechanical.</p>
            <p class="speakable">Jaw claudication is highly specific for giant cell arteritis.</p>
        </div>
        <div class="topic"><div class="topic-title">Treatment Pearls</div>
            <p class="speakable">Start steroids immediately for suspected GCA. Do not wait for biopsy results.</p>
            <p class="speakable">Use ACE inhibitors for scleroderma renal crisis even if creatinine rises.</p>
            <p class="speakable">Don't start or stop urate-lowering therapy during an acute gout attack.</p>
            <p class="speakable">Hydroxychloroquine for everyone with SLE. It reduces flares and mortality.</p>
            <p class="speakable">Use warfarin not DOACs for antiphospholipid syndrome based on TRAPS trial.</p>
            <p class="speakable">Methotrexate doesn't work for axial spondyloarthritis. Use biologics instead.</p>
        </div>
        <div class="topic"><div class="topic-title">Safety Pearls</div>
            <p class="speakable">Screen for TB before starting biologics.</p>
            <p class="speakable">Check HLA-B5801 before allopurinol in Asian or African descent patients.</p>
            <p class="speakable">Eye exam for hydroxychloroquine at baseline then annually after 5 years.</p>
            <p class="speakable">Check TPMT before azathioprine.</p>
            <p class="speakable">Avoid steroids over 15 milligrams daily in diffuse scleroderma. It precipitates renal crisis.</p>
        </div>
    </div>
</div>

<div class="section" data-section="4">
    <div class="section-header"><span>5. Endocrinology</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">Diabetes</div>
            <p class="speakable">SGLT2 inhibitors and GLP-1 agonists have cardiovascular and renal benefits beyond glucose control.</p>
            <p class="speakable">DKA treatment: fluids first, then insulin, then potassium. Hold insulin if potassium under 3.3.</p>
            <p class="speakable">Continue insulin until anion gap closes, not just until glucose normalizes.</p>
            <p class="speakable">Add dextrose to fluids when glucose falls below 200 in DKA.</p>
            <p class="speakable">Overlap subcutaneous and IV insulin by 1 to 2 hours before stopping the drip.</p>
        </div>
        <div class="topic"><div class="topic-title">Thyroid</div>
            <p class="speakable">Thyroid storm: PTU first to block synthesis, then iodine 1 hour later, plus beta-blocker plus steroids.</p>
            <p class="speakable">Give iodine after PTU to prevent using it as substrate for hormone synthesis.</p>
            <p class="speakable">Myxedema coma treatment is IV levothyroxine plus IV hydrocortisone. Treat adrenal insufficiency first.</p>
            <p class="speakable">Amiodarone causes both hyper and hypothyroidism. Check TSH every 6 months.</p>
            <p class="speakable">Subacute thyroiditis is painful. Hashimoto's is painless.</p>
        </div>
        <div class="topic"><div class="topic-title">Adrenal and Other</div>
            <p class="speakable">Adrenal crisis treatment: IV fluids plus IV hydrocortisone 100 milligrams immediately.</p>
            <p class="speakable">Stress dose steroids: double or triple home dose for illness.</p>
            <p class="speakable">Pheochromocytoma: alpha blockade first, then beta. Never give beta first.</p>
            <p class="speakable">Treat prolactinoma medically with dopamine agonists. Surgery is not first-line.</p>
            <p class="speakable">MEN1 is parathyroid, pituitary, pancreas. MEN2A is medullary thyroid cancer, pheo, parathyroid.</p>
        </div>
    </div>
</div>

<div class="section" data-section="5">
    <div class="section-header"><span>6. Nephrology</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">AKI</div>
            <p class="speakable">FENa under 1 percent suggests prerenal. Over 2 percent suggests intrinsic. FENa is unreliable with diuretics; use FEUrea instead.</p>
            <p class="speakable">Contrast nephropathy prevention: IV fluids, hold metformin, use low-osmolar contrast.</p>
            <p class="speakable">ATN recovery phase may have polyuria. Don't restrict fluids; match urine output.</p>
            <p class="speakable">Drug-induced AIN: stop offending drug. Steroids may help if no improvement.</p>
        </div>
        <div class="topic"><div class="topic-title">Electrolytes</div>
            <p class="speakable">Correct sodium no faster than 8 mEq per L in 24 hours to avoid osmotic demyelination.</p>
            <p class="speakable">SIADH treatment: fluid restriction first, then salt tabs, then tolvaptan if needed.</p>
            <p class="speakable">Correct magnesium before trying to correct refractory hypokalemia.</p>
            <p class="speakable">Calcium gluconate stabilizes cardiac membrane in hyperkalemia but doesn't lower potassium.</p>
            <p class="speakable">Tumor lysis syndrome: aggressive hydration, rasburicase, avoid calcium and potassium supplementation.</p>
        </div>
        <div class="topic"><div class="topic-title">CKD and Dialysis</div>
            <p class="speakable">ACE inhibitors and SGLT2 inhibitors are renoprotective. Don't stop for initial creatinine rise up to 30 percent.</p>
            <p class="speakable">Dialysis indications: AEIOU. Acidosis, Electrolytes, Intoxication, Overload, Uremia symptoms.</p>
            <p class="speakable">Emergent dialysis for severe hyperkalemia not responsive to medical therapy.</p>
        </div>
    </div>
</div>

<div class="section" data-section="6">
    <div class="section-header"><span>7. Pulmonology</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">COPD and Asthma</div>
            <p class="speakable">BiPAP for COPD exacerbation with respiratory acidosis reduces intubation and mortality.</p>
            <p class="speakable">Rising or normal PaCO2 in acute asthma is a danger sign indicating fatigue.</p>
            <p class="speakable">Give magnesium 2 grams IV for severe asthma exacerbation.</p>
            <p class="speakable">COPD with eosinophils over 300 predicts ICS response. Use triple therapy.</p>
        </div>
        <div class="topic"><div class="topic-title">ILD and Other</div>
            <p class="speakable">IPF treatment is pirfenidone or nintedanib. Steroids are NOT indicated and may harm.</p>
            <p class="speakable">Ground glass on CT suggests active inflammation that may respond to steroids.</p>
            <p class="speakable">Honeycombing suggests fibrosis which is irreversible.</p>
            <p class="speakable">Sarcoidosis may not need treatment. Many cases resolve spontaneously.</p>
        </div>
        <div class="topic"><div class="topic-title">PE and ARDS</div>
            <p class="speakable">Massive PE with hypotension requires thrombolytics unless contraindicated.</p>
            <p class="speakable">Age-adjusted D-dimer is age times 10 for patients over 50.</p>
            <p class="speakable">ARDS management: low tidal volume 6 mL per kg, plateau pressure under 30, prone positioning for severe cases.</p>
        </div>
    </div>
</div>

<div class="section" data-section="7">
    <div class="section-header"><span>8. Hematology</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">Anemia</div>
            <p class="speakable">Low ferritin confirms iron deficiency. But ferritin under 100 in inflammation also suggests iron deficiency.</p>
            <p class="speakable">Always investigate GI blood loss in men and postmenopausal women with iron deficiency.</p>
            <p class="speakable">Warm AIHA is IgG mediated and treated with steroids then rituximab.</p>
            <p class="speakable">Cold agglutinin disease is IgM mediated. Avoid cold. Treat underlying cause.</p>
        </div>
        <div class="topic"><div class="topic-title">Thrombocytopenia</div>
            <p class="speakable">Do NOT transfuse platelets in TTP. It worsens thrombosis.</p>
            <p class="speakable">TTP treatment is emergent plasma exchange plus steroids plus rituximab. Do not wait for ADAMTS13 results.</p>
            <p class="speakable">HIT typically occurs 5 to 10 days after heparin. It causes thrombosis, not bleeding.</p>
            <p class="speakable">Stop all heparin in HIT including flushes. Start non-heparin anticoagulant immediately.</p>
        </div>
        <div class="topic"><div class="topic-title">Coagulation</div>
            <p class="speakable">Warfarin reversal for bleeding: 4-factor PCC plus vitamin K.</p>
            <p class="speakable">Idarucizumab reverses dabigatran. Andexanet alfa reverses factor Xa inhibitors.</p>
            <p class="speakable">Bleeding and clotting in DIC. Treat underlying cause. Transfuse for active bleeding.</p>
        </div>
    </div>
</div>

<div class="section" data-section="8">
    <div class="section-header"><span>9. Neurology</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">Stroke</div>
            <p class="speakable">tPA for stroke within 4.5 hours. BP must be under 185/110 before giving.</p>
            <p class="speakable">Thrombectomy can extend window up to 24 hours with salvageable penumbra on imaging.</p>
            <p class="speakable">Dual antiplatelet with aspirin plus clopidogrel for 21 days after minor stroke or high-risk TIA.</p>
        </div>
        <div class="topic"><div class="topic-title">Seizures and Headache</div>
            <p class="speakable">Status epilepticus: benzodiazepine first, then fosphenytoin, valproate, or levetiracetam.</p>
            <p class="speakable">Avoid carbamazepine and phenytoin in generalized epilepsy. They worsen absence seizures.</p>
            <p class="speakable">Thunderclap headache requires CT then LP to rule out subarachnoid hemorrhage.</p>
        </div>
        <div class="topic"><div class="topic-title">Neuromuscular</div>
            <p class="speakable">Myasthenia gravis crisis: check FVC frequently. Intubate if FVC under 15 to 20 mL per kg.</p>
            <p class="speakable">Avoid aminoglycosides and fluoroquinolones in myasthenia gravis.</p>
            <p class="speakable">Guillain-Barr√© treatment is IVIG or plasmapheresis. Steroids do not help.</p>
        </div>
    </div>
</div>

<div class="section" data-section="9">
    <div class="section-header"><span>10. Other Specialties</span><span>üíé</span></div>
    <div class="section-content">
        <div class="topic"><div class="topic-title">Women's Health</div>
            <p class="speakable">Preeclampsia: BP over 140/90 plus proteinuria or end-organ damage after 20 weeks. Treatment is delivery.</p>
            <p class="speakable">Magnesium sulfate for seizure prophylaxis in severe preeclampsia and eclampsia.</p>
            <p class="speakable">DVT prophylaxis is critical in pregnancy due to hypercoagulable state.</p>
        </div>
        <div class="topic"><div class="topic-title">Perioperative</div>
            <p class="speakable">Continue beta-blockers perioperatively. Starting high-dose beta-blocker day of surgery increases stroke risk.</p>
            <p class="speakable">Hold ACE inhibitors and ARBs morning of surgery to avoid hypotension.</p>
            <p class="speakable">Bridging anticoagulation is usually NOT indicated for afib. BRIDGE trial.</p>
        </div>
        <div class="topic"><div class="topic-title">Dermatology</div>
            <p class="speakable">Pemphigus vulgaris is intraepidermal. Bullous pemphigoid is subepidermal with tense bullae.</p>
            <p class="speakable">Nikolsky sign positive in pemphigus, negative in pemphigoid.</p>
            <p class="speakable">Stevens-Johnson syndrome and TEN: stop offending drug, supportive care, consider IVIG.</p>
        </div>
        <div class="topic"><div class="topic-title">Palliative Care</div>
            <p class="speakable">Opioids are first-line for dyspnea in advanced disease.</p>
            <p class="speakable">Morphine does not hasten death when used appropriately for symptom control.</p>
            <p class="speakable">Anticipatory grief is normal. Distinguish from complicated grief which needs referral.</p>
        </div>
    </div>
</div>

</div>
<div class="audio-controls">
    <div class="controls-row"><button class="control-btn" onclick="skipBackward()">‚è™</button><button class="control-btn play-btn" id="playPauseBtn" onclick="togglePlayPause()">‚ñ∂Ô∏è</button><button class="control-btn" onclick="skipForward()">‚è©</button><button class="control-btn" onclick="stopReading()">‚èπÔ∏è</button></div>
    <div class="progress-section"><span id="currentTime">0:00</span><div class="progress-bar" onclick="seekTo(event)"><div class="progress-fill" id="progressFill"></div></div><span id="totalTime">0:00</span></div>
    <div class="current-topic" id="currentTopic">Ready to play</div>
    <div class="settings-row"><div class="speed-control"><label>Speed:</label><select id="speedSelect" onchange="updateSpeed()"><option value="0.75">0.75√ó</option><option value="1" selected>1√ó</option><option value="1.5">1.5√ó</option><option value="2">2√ó</option></select></div><div class="pause-control"><label>Pauses:</label><select id="pauseSelect" onchange="updatePauses()"><option value="short">Short</option><option value="medium" selected>Medium</option><option value="long">Long</option></select></div></div>
</div>
<script>
let isPlaying=false,currentSentenceIndex=0,sentences=[],speechRate=1,englishVoices=[],pauseSettings={sentence:400,paragraph:800,section:1500};
document.addEventListener('DOMContentLoaded',()=>{loadVoices();buildSentenceList();setupTOC();const s=localStorage.getItem('pearls_audio_pos');if(s)currentSentenceIndex=parseInt(s)||0;});
function loadVoices(){const sel=document.getElementById('voiceSelect');function pop(){const all=speechSynthesis.getVoices();englishVoices=all.filter(v=>v.lang.startsWith('en-'));if(!englishVoices.length){setTimeout(pop,100);return;}sel.innerHTML='';englishVoices.forEach((v,i)=>{const o=document.createElement('option');o.value=i;o.textContent=`${v.localService?'‚≠ê ':''}${v.name}`;sel.appendChild(o);});}pop();speechSynthesis.onvoiceschanged=pop;}
function buildSentenceList(){sentences=[];document.querySelectorAll('.speakable').forEach((el,i,arr)=>{const sec=el.closest('.section'),top=el.closest('.topic');sentences.push({text:el.textContent.trim(),element:el,section:sec?parseInt(sec.dataset.section):0,topic:top?.querySelector('.topic-title')?.textContent||'',isNewBlock:i===0||el.closest('.topic')!==arr[i-1]?.closest('.topic'),isNewSection:i===0||(sec?.dataset.section!==arr[i-1]?.closest('.section')?.dataset.section)});});updateProgress();}
function setupTOC(){document.querySelectorAll('.toc-item').forEach(item=>{item.addEventListener('click',()=>jumpToSection(parseInt(item.dataset.section)));});}
function jumpToSection(idx){const i=sentences.findIndex(s=>s.section===idx);if(i!==-1){currentSentenceIndex=i;if(isPlaying){speechSynthesis.cancel();speakCurrentSentence();}updateProgress();}}
function togglePlayPause(){isPlaying?pauseReading():startReading();}
function startReading(){isPlaying=true;document.getElementById('playPauseBtn').textContent='‚è∏Ô∏è';speakCurrentSentence();}
function pauseReading(){isPlaying=false;speechSynthesis.cancel();document.getElementById('playPauseBtn').textContent='‚ñ∂Ô∏è';localStorage.setItem('pearls_audio_pos',currentSentenceIndex);}
function stopReading(){isPlaying=false;speechSynthesis.cancel();currentSentenceIndex=0;document.getElementById('playPauseBtn').textContent='‚ñ∂Ô∏è';updateProgress();localStorage.removeItem('pearls_audio_pos');}
function speakCurrentSentence(){if(!isPlaying||currentSentenceIndex>=sentences.length){if(currentSentenceIndex>=sentences.length)stopReading();return;}const s=sentences[currentSentenceIndex],u=new SpeechSynthesisUtterance(s.text),vi=parseInt(document.getElementById('voiceSelect').value)||0;if(englishVoices[vi])u.voice=englishVoices[vi];u.lang='en-US';u.rate=speechRate;document.querySelectorAll('.current').forEach(el=>el.classList.remove('current'));s.element.classList.add('current');s.element.scrollIntoView({behavior:'smooth',block:'center'});document.getElementById('currentTopic').textContent=s.topic;updateProgress();u.onend=()=>{currentSentenceIndex++;if(currentSentenceIndex<sentences.length){let p=pauseSettings.sentence;if(sentences[currentSentenceIndex].isNewSection)p=pauseSettings.section;else if(sentences[currentSentenceIndex].isNewBlock)p=pauseSettings.paragraph;setTimeout(()=>{if(isPlaying)speakCurrentSentence();},p);}else stopReading();};speechSynthesis.speak(u);}
function updateProgress(){const pct=sentences.length?(currentSentenceIndex/sentences.length)*100:0;document.getElementById('progressFill').style.width=pct+'%';const avg=3/speechRate;document.getElementById('currentTime').textContent=Math.floor(currentSentenceIndex*avg/60)+':'+(Math.floor(currentSentenceIndex*avg)%60).toString().padStart(2,'0');document.getElementById('totalTime').textContent=Math.floor(sentences.length*avg/60)+':'+(Math.floor(sentences.length*avg)%60).toString().padStart(2,'0');}
function seekTo(e){currentSentenceIndex=Math.floor((e.offsetX/e.currentTarget.offsetWidth)*sentences.length);if(isPlaying){speechSynthesis.cancel();speakCurrentSentence();}updateProgress();}
function skipForward(){currentSentenceIndex=Math.min(currentSentenceIndex+10,sentences.length-1);if(isPlaying){speechSynthesis.cancel();speakCurrentSentence();}updateProgress();}
function skipBackward(){currentSentenceIndex=Math.max(currentSentenceIndex-10,0);if(isPlaying){speechSynthesis.cancel();speakCurrentSentence();}updateProgress();}
function updateSpeed(){speechRate=parseFloat(document.getElementById('speedSelect').value);updateProgress();}
function updatePauses(){const s=document.getElementById('pauseSelect').value;pauseSettings=s==='short'?{sentence:200,paragraph:400,section:800}:s==='long'?{sentence:600,paragraph:1200,section:2000}:{sentence:400,paragraph:800,section:1500};}
</script>
</body>
</html>
